<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Monitor</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%23111114'/%3E%3Crect x='5' y='10' width='9' height='14' rx='2' fill='%2356d4dd'/%3E%3Crect x='18' y='6' width='9' height='18' rx='2' fill='%2373e0a0'/%3E%3C/svg%3E">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

    <!-- CSS Modules -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabs.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/kanban.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/panels.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/headspace.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/priority.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/roadmap.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/readme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
</head>
<body>
    <!-- Brain Reboot Side Panel -->
    <div id="reboot-panel-overlay" class="reboot-panel-overlay"></div>
    <div id="reboot-panel" class="reboot-panel">
        <div class="reboot-panel-header">
            <span class="reboot-panel-title">Headspace: <span id="reboot-panel-project-name"></span></span>
            <button class="reboot-panel-close" onclick="closeRebootPanel()">&times;</button>
        </div>
        <div id="reboot-panel-content" class="reboot-panel-content">
            <div class="reboot-loading">Loading briefing...</div>
        </div>
    </div>

    <!-- Context Panel (Session Detail Side Panel) -->
    <div id="context-panel-overlay" class="context-panel-overlay" onclick="closeContextPanel()"></div>
    <div id="context-panel" class="context-panel">
        <div class="context-panel-header">
            <span class="context-panel-title" id="context-panel-project-name"></span>
            <button class="context-panel-close" onclick="closeContextPanel()">&times;</button>
        </div>
        <div id="context-panel-content" class="context-panel-content">
            <div class="reboot-loading">Loading context...</div>
        </div>
        <div class="context-panel-actions">
            <button class="context-focus-btn" id="context-focus-btn" onclick="focusContextSession()">Focus iTerm Window</button>
        </div>
    </div>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="kanban">sessions</button>
        <button class="tab-btn" data-tab="health">readme.md</button>
        <button class="tab-btn" data-tab="settings">config.yaml</button>
    </nav>

    <!-- Kanban Tab -->
    <div id="kanban-tab" class="tab-content active">
        <header>
            <pre class="ascii-title"> ██████╗██╗      █████╗ ██╗   ██╗██████╗ ███████╗
██╔════╝██║     ██╔══██╗██║   ██║██╔══██╗██╔════╝
██║     ██║     ███████║██║   ██║██║  ██║█████╗
██║     ██║     ██╔══██║██║   ██║██║  ██║██╔══╝
╚██████╗███████╗██║  ██║╚██████╔╝██████╔╝███████╗
 ╚═════╝╚══════╝╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚══════╝
            M O N I T O R</pre>
            <p class="subtitle">tracking claude code sessions across projects</p>
            <div class="stats-bar" id="stats-bar">
                <div class="stat-item">
                    <span class="stat-label">input needed</span>
                    <span class="stat-value input-needed" id="input-needed-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">working</span>
                    <span class="stat-value active" id="working-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">idle</span>
                    <span class="stat-value idle" id="idle-count">0</span>
                </div>
            </div>
        </header>

        <!-- Headspace Panel -->
        <div id="headspace-panel" class="headspace-panel" style="display: none;">
            <div class="headspace-header">
                <span class="headspace-label">HEADSPACE</span>
                <button class="headspace-edit-btn" onclick="enterHeadspaceEditMode()">Edit</button>
            </div>

            <!-- View Mode -->
            <div class="headspace-view">
                <div class="headspace-focus" id="headspace-focus"></div>
                <div class="headspace-constraints" id="headspace-constraints" style="display: none;">
                    <span class="headspace-constraints-label">Constraints:</span>
                    <span id="headspace-constraints-text"></span>
                </div>
                <div class="headspace-timestamp" id="headspace-timestamp"></div>
            </div>

            <!-- Edit Mode -->
            <div class="headspace-edit-form">
                <div class="headspace-input-group">
                    <label class="headspace-input-label">Focus</label>
                    <input type="text" class="headspace-input" id="headspace-focus-input" placeholder="What's your focus right now?">
                </div>
                <div class="headspace-input-group">
                    <label class="headspace-input-label">Constraints (optional)</label>
                    <input type="text" class="headspace-input" id="headspace-constraints-input" placeholder="Any limitations or boundaries?">
                </div>
                <div class="headspace-edit-actions">
                    <button class="headspace-cancel-btn" onclick="exitHeadspaceEditMode()">Cancel</button>
                    <button class="headspace-save-btn" onclick="saveHeadspace()">Save</button>
                </div>
            </div>

            <!-- Empty State -->
            <div class="headspace-empty" id="headspace-empty" style="display: none;">
                <div class="headspace-empty-prompt">What's your focus right now?</div>
                <div class="headspace-empty-hint">Setting a headspace helps you stay intentional.</div>
            </div>
        </div>

        <!-- Recommended Next Panel -->
        <div id="recommended-next-panel" class="recommended-next-panel" style="display: none;" onclick="focusRecommendedSession()">
            <div class="recommended-next-header">
                <span class="recommended-next-label">RECOMMENDED NEXT</span>
                <span class="recommended-next-score" id="recommended-next-score"></span>
            </div>
            <div class="recommended-next-content">
                <div class="recommended-next-project">
                    <span class="recommended-next-name" id="recommended-next-name"></span>
                    <span class="recommended-next-state" id="recommended-next-state"></span>
                </div>
                <div class="recommended-next-rationale" id="recommended-next-rationale"></div>
                <div class="recommended-next-action">Click to focus iTerm window</div>
            </div>
            <!-- Empty state (shown when no sessions) -->
            <div class="recommended-next-empty" id="recommended-next-empty" style="display: none;">
                No active sessions
            </div>
        </div>

        <!-- Sort Toggle -->
        <div id="sort-toggle-container" class="sort-toggle-container" style="display: none;">
            <span class="sort-toggle-label">Sort:</span>
            <div class="sort-toggle">
                <button class="sort-toggle-btn" id="sort-by-project" onclick="setSortMode('project')">By Project</button>
                <button class="sort-toggle-btn active" id="sort-by-priority" onclick="setSortMode('priority')">By Priority</button>
            </div>
            <div class="soft-transition-indicator" id="soft-transition-indicator">
                <span>&#8635;</span>
                <span>Priorities updating...</span>
            </div>
        </div>

        <div id="kanban" class="kanban">
            <div class="no-sessions">initializing...</div>
        </div>
    </div>

    <!-- Health Tab -->
    <div id="health-tab" class="tab-content">
        <div class="readme-container">
            <div class="readme-header">
                <div class="window-dots">
                    <span class="window-dot red"></span>
                    <span class="window-dot yellow"></span>
                    <span class="window-dot green"></span>
                </div>
                <span class="readme-filename">README.md</span>
            </div>
            <div id="readme-content" class="readme-content">
                <p>loading documentation...</p>
            </div>
        </div>
    </div>

    <!-- Settings Tab -->
    <div id="settings-tab" class="tab-content">
        <div class="settings-container">
            <div class="settings-section">
                <div class="settings-section-header">
                    <h2>monitored_projects</h2>
                </div>
                <div class="settings-section-body">
                    <p class="settings-description">Configure the projects that Claude Monitor will track.</p>

                    <div id="project-list" class="project-list">
                        <!-- Projects will be rendered here -->
                    </div>

                    <button class="btn btn-secondary" onclick="addProject()">+ add_project</button>

                    <div class="settings-actions">
                        <button class="btn" onclick="saveSettings()">save_config</button>
                    </div>

                    <div id="settings-status" class="settings-status"></div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-header">
                    <h2>options</h2>
                </div>
                <div class="settings-section-body">
                    <div class="setting-row">
                        <label>scan_interval</label>
                        <input type="number" id="scan-interval" min="1" max="60" value="2">
                        <span class="setting-hint">seconds</span>
                    </div>
                    <div class="setting-row">
                        <label>focus_delay</label>
                        <input type="number" id="focus-delay" min="0" max="1" step="0.1" value="0.1">
                        <span class="setting-hint">seconds</span>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-header">
                    <h2>notifications</h2>
                </div>
                <div class="settings-section-body">
                    <p class="settings-description">Native macOS notifications when input is needed or tasks complete.</p>
                    <div class="setting-row">
                        <label>enabled</label>
                        <button id="notification-toggle-btn" class="btn btn-secondary" onclick="toggleNotifications()">loading...</button>
                    </div>
                    <div class="setting-row">
                        <label>test</label>
                        <button class="btn btn-secondary" onclick="testMacNotification()">send test notification</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="refresh-indicator" class="refresh-indicator">
        last_sync: --
    </div>

    <!-- Inline config from Jinja template -->
    <script>
        window.CONFIG = {
            refreshInterval: {{ scan_interval * 1000 }}
        };
    </script>

    <!-- JS Modules (order matters for dependencies) -->
    <script src="{{ url_for('static', filename='js/config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/polling.js') }}"></script>
    <script src="{{ url_for('static', filename='js/kanban.js') }}"></script>
    <script src="{{ url_for('static', filename='js/priorities.js') }}"></script>
    <script src="{{ url_for('static', filename='js/headspace.js') }}"></script>
    <script src="{{ url_for('static', filename='js/roadmap.js') }}"></script>
    <script src="{{ url_for('static', filename='js/panels.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tabs.js') }}"></script>
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
